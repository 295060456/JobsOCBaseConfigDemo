<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>POST æäº¤ - å…¨åŠŸèƒ½æ—¥å¿—å±•ç¤º</title>
  <script src="config.js"></script>
  <style>
    :root {
      --bg: #f0f2f5;       --text: #333;        --card-bg: #fff;
      --border: #eee;      --primary: #1890ff;  --pre-bg: #f6f8fa;
      --online: #52c41a;   --offline: #ff4d4f;
    }
    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #1e1e1e;    --text: #ddd;        --card-bg: #2c2c2c;
        --border: #444;   --primary: #40a9ff;  --pre-bg: #2e2e2e;
      }
    }
    body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
         background:var(--bg);color:var(--text);margin:0;padding:30px;}
    #netStatus{text-align:center;padding:10px;font-weight:bold;color:#fff;
               background:var(--online);border-radius:6px;margin-bottom:20px;}
    .offline{background:var(--offline)!important;}
    .container{max-width:720px;margin:auto;background:var(--card-bg);
               padding:25px 30px;border-radius:10px;box-shadow:0 4px 12px rgba(0,0,0,.08);
               border:1px solid var(--border);}
    h2{text-align:center;color:var(--primary);}
    .info-label{background:rgba(24,144,255,.1);border-left:5px solid var(--primary);
                padding:12px 16px;margin:20px 0;border-radius:6px;}
    .section-title{font-weight:bold;font-size:15px;color:var(--primary);
                   margin:24px 0 6px;}
    form label{display:block;margin-top:12px;font-weight:500;}
    input{width:100%;padding:8px 12px;font-size:14px;border:1px solid #ccc;
          border-radius:6px;margin-top:4px;background:#fff;box-sizing:border-box;
          transition:border-color .3s;}
    @media (prefers-color-scheme:dark){
      input{background:#1e1e1e;color:#eee;border-color:#555;}
    }
    input:focus{border-color:var(--primary);outline:none;}
    .data-section{background:var(--pre-bg);border:1px solid var(--border);
                  padding:16px;border-radius:8px;margin-top:10px;}
    button{background:var(--primary);color:#fff;border:none;padding:12px 20px;
           font-size:16px;border-radius:6px;cursor:pointer;transition:background .3s;}
    button:hover{background:#40a9ff;}
    .action-btn{float:right;margin:-40px 0 10px 5px;padding:5px 10px;
                font-size:12px;background:#eee;border:1px solid #ccc;border-radius:4px;}
    .action-btn:hover{background:var(--primary);color:#fff;border-color:var(--primary);}
    pre{margin-top:20px;background:var(--pre-bg);padding:16px;border-radius:6px;
        font-size:14px;white-space:pre-wrap;border-left:5px solid var(--primary);
        overflow-x:auto;}
  </style>
</head>
<body>
  <!-- ç½‘ç»œçŠ¶æ€ & IP -->
  <div id="netStatus">ğŸ”„ æ£€æµ‹ç½‘ç»œçŠ¶æ€ä¸­...</div>

  <div class="container">
    <h2>POST æäº¤æµ‹è¯• - å…¨åŠŸèƒ½æ—¥å¿—å±•ç¤º</h2>

    <p class="info-label">
      ğŸ“Œ æäº¤åå°†å±•ç¤ºå®Œæ•´è¯·æ±‚ / å“åº” / è€—æ—¶ / æ—¶é—´æˆ³ / å®¢æˆ·ç«¯IP ç­‰ä¿¡æ¯ï¼Œå¹¶å¯å¤åˆ¶æˆ–ä¸‹è½½ JSONã€‚
    </p>

    <!-- è¡¨å• -->
    <form id="postForm">
      <div class="section-title">msg:</div>
      <input type="text" name="msg" value="åˆ›å»ºæˆåŠŸ" required>

      <div class="section-title">code:</div>
      <input type="number" name="code" value="201" required>

      <div class="section-title">data éƒ¨åˆ†ï¼š</div>
      <div class="data-section">
        <label>title:
          <input type="text" name="title" value="ç¤ºä¾‹æ–‡ç« æ ‡é¢˜" required>
        </label>
        <label>author.id:
          <input type="number" name="author_id" value="1" required>
        </label>
        <label>author.name:
          <input type="text" name="author_name" value="å¼ ä¸‰" required>
        </label>
        <label>author.email:
          <input type="email" name="author_email" value="test@example.com" required>
        </label>
        <label>tags:
          <input type="text" name="tags" value="tag1,tag2">
        </label>
        <label>metadata.views:
          <input type="number" name="views" value="100">
        </label>
        <label>metadata.likes:
          <input type="number" name="likes" value="10">
        </label>
        <label>metadata.published_at:
          <input type="datetime-local" name="published_at" id="published_at">
        </label>
      </div>

      <button type="submit">æäº¤ POST è¯·æ±‚</button>
    </form>

    <!-- æ“ä½œæŒ‰é’® -->
    <button class="action-btn" id="downloadBtn" onclick="downloadJSON()" disabled>ğŸ’¾ ä¸‹è½½å“åº” JSON</button>
    <button class="action-btn" onclick="copyResponse()">ğŸ“‹ å¤åˆ¶å…¨éƒ¨è¾“å‡º</button>

    <!-- è¾“å‡ºåŒº -->
    <pre id="response">ğŸ“­ ç­‰å¾…æäº¤...</pre>
  </div>

  <script>
    /* ---------- åˆå§‹åŒ–é»˜è®¤æ—¶é—´ ---------- */
    const pad = n => n.toString().padStart(2,'0');
    const now = new Date();
    document.getElementById('published_at').value =
      `${now.getFullYear()}-${pad(now.getMonth()+1)}-${pad(now.getDate())}T${pad(now.getHours())}:${pad(now.getMinutes())}`;

    /* ---------- ç½‘ç»œçŠ¶æ€ & IP ---------- */
    const netStatus = document.getElementById('netStatus');
    let clientIP = 'è·å–ä¸­...';
    fetch('https://api.ipify.org?format=json')
      .then(r=>r.json()).then(d=>{clientIP=d.ip; updateNetworkStatus();})
      .catch(()=>{clientIP='æœªçŸ¥'; updateNetworkStatus();});

    function updateNetworkStatus(){
      const online = navigator.onLine;
      netStatus.textContent = `${online ? 'âœ… ç½‘ç»œå·²è¿æ¥' : 'âš ï¸ ç½‘ç»œå·²æ–­å¼€'} | IP: ${clientIP}`;
      netStatus.classList.toggle('offline', !online);
    }
    window.addEventListener('online', updateNetworkStatus);
    window.addEventListener('offline', updateNetworkStatus);

    /* ---------- å…¨å±€å˜é‡ ---------- */
    const responseBox = document.getElementById('response');
    let lastResponseJSON = null;

    /* ---------- å¤åˆ¶ ---------- */
    function copyResponse(){
      navigator.clipboard.writeText(responseBox.textContent)
        .then(()=>alert('âœ… å·²å¤åˆ¶åˆ°å‰ªè´´æ¿'))
        .catch(err=>alert('âŒ å¤åˆ¶å¤±è´¥ï¼š'+err));
    }

    /* ---------- ä¸‹è½½ ---------- */
    function downloadJSON(){
      if(!lastResponseJSON){
        alert('âš ï¸ è¿˜æ²¡æœ‰å¯ä¸‹è½½çš„å“åº”ä½“');
        return;
      }
      const blob = new Blob([JSON.stringify(lastResponseJSON,null,2)],{type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'response.json'; a.click();
      URL.revokeObjectURL(url);
    }

    /* ---------- è¡¨å•æäº¤ ---------- */
    document.getElementById('postForm').addEventListener('submit', async e=>{
      e.preventDefault();
      lastResponseJSON = null;
      document.getElementById('downloadBtn').disabled = true;

      /* ç»„è£…è¯·æ±‚ä½“ */
      const f = new FormData(e.target);
      const payload = {
        msg: f.get('msg'),
        code: Number(f.get('code')),
        data:{
          title:f.get('title'),
          author:{
            id:Number(f.get('author_id')),
            name:f.get('author_name'),
            email:f.get('author_email')
          },
          tags:f.get('tags').split(',').map(t=>t.trim()).filter(Boolean),
          metadata:{
            views:Number(f.get('views')),
            likes:Number(f.get('likes')),
            published_at:new Date(f.get('published_at')).toISOString()
          }
        }
      };

      /* æ‰“å°è¯·æ±‚ä¿¡æ¯ */
      const url = `http://localhost:${JSON_SERVER_PORT}/posts`;
      const headers = {'Content-Type':'application/json'};
      responseBox.textContent =
        `ğŸ“ å¼€å§‹æ—¶é—´: ${new Date().toISOString()}\n`+
        `ğŸ“¤ è¯·æ±‚ä¿¡æ¯ï¼š\nURL: ${url}\nMethod: POST\nHeaders: ${JSON.stringify(headers,null,2)}\n`+
        `Body:\n${JSON.stringify(payload,null,2)}\n\nâ³ æ­£åœ¨ç­‰å¾…å“åº”...\n`;

      const t0 = performance.now();
      const t0Date = new Date();

      try{
        const res = await fetch(url,{method:'POST',headers,body:JSON.stringify(payload)});
        const t1 = performance.now();
        const t1Date = new Date();
        const duration = Math.round(t1 - t0);

        const resHeaders = {};
        res.headers.forEach((v,k)=>resHeaders[k]=v);
        const statusLine = `${res.status} ${res.statusText}`;
        const json = await res.json();
        lastResponseJSON = json;
        document.getElementById('downloadBtn').disabled = false;

        responseBox.textContent +=
          `\nâœ… ç»“æŸæ—¶é—´: ${t1Date.toISOString()}\n`+
          `â±ï¸ è€—æ—¶: ${duration} ms\n`+
          `å“åº”çŠ¶æ€ç : ${statusLine}\n\n`+
          `å“åº”å¤´:\n${JSON.stringify(resHeaders,null,2)}\n\n`+
          `å“åº”ä½“:\n${JSON.stringify(json,null,2)}\n`;
      }catch(err){
        responseBox.textContent += `\nâŒ è¯·æ±‚å¤±è´¥ï¼š${err}\n`;
      }
    });
  </script>
</body>
</html>
